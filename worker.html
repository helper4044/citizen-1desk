<!DOCTYPE html>
<html>
<head>
<title>Worker Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#0f2027;color:#fff}
header{background:#081821;padding:14px;text-align:center;font-weight:bold}
.wrap{max-width:900px;margin:20px auto}
.card{background:#122733;padding:16px;border-radius:12px;border:2px solid #00ffcc;margin-bottom:14px}
img{width:100%;border-radius:10px;margin-top:10px}
button{padding:8px 14px;border-radius:8px;border:0;margin-top:8px;font-weight:bold}
.work{background:#ffa500}
.done{background:#00ffcc}
.route{background:#007bff;color:#fff}
</style>
</head>

<body>

<header>Worker Dashboard</header>
<div class="wrap" id="wrap"></div>

<script>
const BIN_ID="69149419ae596e708f54b77e";
const API_KEY="$2a$10$M82XOQ0SzJJkyIbSqmB.N.P3E4SU23ePZ5D2QBby.ZbLAlwgBK3c6";

let data=[];

async function load(){
  const r=await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`,{
    headers:{"X-Master-Key":API_KEY}
  });
  const j=await r.json();
  data=j.record?.complaints||[];
  wrap.innerHTML="";

  data.forEach((c,i)=>{
    const d=document.createElement("div");
    d.className="card";
    d.innerHTML=`
      <b>${c.issue}</b><br>
      ${c.desc}<br><br>
      Status: <b>${c.status}</b><br>
      ${c.image?`<img src="${c.image}">`:"No Image"}<br><br>
      <button class="route" onclick="route(${c.lat},${c.lng})">Route</button>
      <button class="work" onclick="update(${i},'Under Working')">Take Action</button>
      <button class="done" onclick="update(${i},'Completed')">Mark Completed</button>
    `;
    wrap.appendChild(d);
  });
}

async function update(i,status){
  data[i].status=status;
  await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`,{
    method:"PUT",
    headers:{"Content-Type":"application/json","X-Master-Key":API_KEY},
    body:JSON.stringify({complaints:data})
  });
  load();
}

function route(lat,lng){
  window.open(`https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`);
}

load();
</script>

</body>
</html>